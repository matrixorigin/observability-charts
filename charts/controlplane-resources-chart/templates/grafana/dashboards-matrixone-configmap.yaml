## cooperate with {folder_to_char}/grafana/dashboards/matrixone/*.json
##            and {folder_to_char}/grafana/dashboards/matrixone/*_labels.yaml
{{- if and .Values.grafana.dashboards.enabled .Values.grafana.dashboards.matrixone.enabled }}
{{- $files := .Files.Glob "grafana/dashboards/matrixone/*.json" }}
{{- if $files }}
apiVersion: v1
kind: ConfigMapList
items:
{{- range $path, $fileContents := $files }}
{{- $dashboardName := regexReplaceAll "(^.*/)(.*/)(.*)\\.json$" $path "${3}" }}
{{- $dashboardLabelYamlPath := printf "grafana/dashboards/%s_%s" $dashboardName "labels.yaml" }}
- apiVersion: v1
  kind: ConfigMap
  metadata:
    namespace: {{ $.Values.grafana.namespace }}
    name: {{ printf "%s-%s" "mo-core" (lower $dashboardName) | replace "_" "-" | trunc 63 | trimSuffix "-" }}
    #labels-file-name: {{ $dashboardLabelYamlPath  }}
    labels:
      grafana_dashboard: "1"
      app: "controlplane-resources"
      {{ $.Files.Get $dashboardLabelYamlPath | nindent 6 }}
  data:
    {{ printf "mo-core-%s.json" $dashboardName }}: {{ $.Files.Get $path | toJson }}
{{- end }}
{{- end }}
{{- end }}
