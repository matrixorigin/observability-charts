labels:
  matrixone.cloud/rule-type: log
  matrixone.cloud/unit-name: control-plane
groups:
- name: userAlerting.rules
  rules:
  - alert: FetchUserRuleFromDBFailed
    expr: count_over_time({app="cluster-ob-service"} | json | msg =~ `.*Failed to fetch org.*` [5m]) > 0
    for: 0m
    labels:
      alertname: FetchUserRuleFromDBFailed
      severity: "warning"
      serviceScope: "mo-ob"
      alertOwner: bruce
      alertTeam: "Orch Team"
    annotations:
      summary: "fetch alert rule from db failed: {{ $labels.msg }}"
      description: "fetch alert rule from db failed: {{ $labels.msg }}"
  - alert: UserRuleReconcileFailed
    expr: count_over_time({app="cluster-ob-service"} | json | msg =~ `.*Failed to reconcile org.*` [5m]) > 0
    for: 1m
    labels:
      alertname: UserRuleReconcileFailed
      severity: "warning"
      serviceScope: "mo-ob"
      alertOwner: bruce
      alertTeam: "Orch Team"
    annotations:
      summary: "alert rule reconcile failed: {{ $labels.msg }}"
      description: "alert rule reconcile failed: {{ $labels.msg }}"
  - alert: UserRuleReconcileRetryFailed
    expr: count_over_time({app="cluster-ob-service"} | json | msg =~ `.*retry time approch to max.*` [5m]) > 0
    for: 0m
    labels:
      alertname: UserRuleReconcileRetryFailed
      severity: "critical"
      serviceScope: "mo-ob"
      alertOwner: bruce
      alertTeam: "Orch Team"
    annotations:
      summary: "alert rule reconcile retry failed: {{ $labels.msg }}"
      description: "alert rule reconcile retry failed: {{ $labels.msg }}"
  - alert: SendNotifyReachLimit
    expr: count_over_time({app="incident-worker"} | json | msg =~ `.*sent already reach limit.*` [5m]) > 0
    for: 0m
    labels:
      alertname: SendNotifyReachLimit
      severity: "critical"
      serviceScope: "mo-ob"
      alertOwner: bruce
      alertTeam: "Orch Team"
    annotations:
      summary: "user notify times reach limit: {{ $labels.msg }}"
      description: "user notify times reach limit: {{ $labels.msg }}"
  - alert: SendNotifyFailed
    expr: count_over_time({app="incident-worker"} | json | msg =~ `.*notifications failed.*` [5m]) > 0
    for: 0m
    labels:
      alertname: SendNotifyFailed
      severity: "critical"
      serviceScope: "mo-ob"
      alertOwner: bruce
      alertTeam: "Orch Team"
    annotations:
      summary: " send notification to user failed times: {{ $labels.msg }}"
      description: " send notification to user failed times: {{ $labels.msg }}"
