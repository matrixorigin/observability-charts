labels:
  matrixone.cloud/rule-type: log
  matrixone.cloud/unit-name: default
  matrixone.cloud/control-plane: "true"
groups:
- name: promtail.rules
  rules:
  - alert: PromtailErrorSendingRetry
    expr: count_over_time({app="promtail"} |= `level=warn` |= `error sending batch, will retry` [1m]) > 0
    for: 1m
    labels:
      alertname: PromtailErrorSendingRetry
      severity: "info"
      serviceScope: "mo-ob"
      alertOwner: bruce
      alertTeam: "Orch Team"
    annotations:
      summary: "{{ $labels.pod }}: error sending batch on {{ $labels.node_name }}, will retry"
      description: "{{ $labels.pod }}: error sending batch on {{ $labels.node_name }}, will retry"
  - alert: PromtailErrorSendingFinal
    expr: sum by (app) (count_over_time({app="promtail"} |= `level=error` |= `final error sending batch` [1m])) > 0
    for: 6m
    labels:
      alertname: PromtailErrorSendingFinal
      severity: "warning"
      serviceScope: "mo-ob"
      alertOwner: bruce
      alertTeam: "Orch Team"
    annotations:
      summary: "{{ $labels.pod }}: final error sending batch on {{ $labels.node_name }}"
      description: "{{ $labels.pod }}: final error sending batch on {{ $labels.node_name }}"
  - alert: PromtailLabelsLimit
    expr: count by(container) (count_over_time({namespace="mo-ob", container="promtail"} |~ `label names; limit` [1m] offset 1m)) > 0
    for: 0m
    labels:
      alertname: PromtailLabelsLimit
      severity: "warning"
      serviceScope: "mo-ob"
      alertOwner: jacksonxie
      alertTeam: "Orch Team"
    annotations:
      summary: "promtail: The number of labels a pod can have exceeds the limit. more in https://github.com/matrixorigin/MO-Cloud/issues/3151"
      description: "promtail: The number of labels a pod can have exceeds the limit. (1 min ago)"
